#parse("index-extract.vm")
<template>
    <div class="service-split-fee pl24 pr24 pt24">
        <!--  查询表单   -->
        <el-form label-width="${tableConfig.searchLabelWidth}px" ref="refSearchForm" :model="searchFormMixin">
            <el-row :gutter="35" class="rowSS">
                #queryFormItemTmp()
                <el-col style="width: 260px">
                    <!--查询按钮-->
                    <el-button type="primary" plain class="ml30" @click.stop="initQueryList">查询</el-button>
                    <el-button type="reset" @click.native="resetBtnMixin('refSearchForm')">重置</el-button>
                </el-col>
            </el-row>
        </el-form>
        <!-- 表单操作   -->
        <div class="mb24 rowEC">
            #if($tableConfig.isAdd=="true")
                <el-button
                    @click="routerPushMixin('/${basicConfig.routerParentDir}/${basicConfig.apiFileName}-add-edit', { type: 'add' })">
                    新建
                </el-button>
            #end
            #if($tableConfig.isImport=="true")
                <el-button @click="importBtnClick">导入</el-button>
            #end
            #if($tableConfig.isExport=="true")
                <el-button @click="exportBtnClick" v-if="tableDataMixin.length">导出</el-button>
            #end
            #if($tableConfig.isFilterHead=="true")
                <ColumnFilter :is-operation="true" v-if="tableDataMixin.length" :cols="tableHeadArrMixin"
                              @colChange="colChangeMixin"/>
            #end
        </div>
        <!-- el-table   -->
        <el-table
            v-if="tableDataMixin.length"
            ref="refElTable"
            style="width: 100%"
            :loading="tableLoadingMixin"
            border
            :data="tableDataMixin"
        >
            <template v-for="(item, index) in tableHeadArrMixin">
                <el-table-column
                    v-if="!item.isNotShowCol && !item.isTemplate"
                    :key="item.prop"
                    show-overflow-tooltip
                    v-bind="item"
                    :align="index === 0 ? 'left' : item.align ? item.align : 'center'"
                    :prop="item.prop"
                    :label="item.label"
                >
                    <template v-slot="{ row }">
                        <span>{{valueDillMixin( row[item.prop])}}</span>
                    </template>
                </el-table-column>
                #customTableHead()
            </template>
            <!--点击操作-->
            <el-table-column fixed="right" align="center" label="操作" width="${tableConfig.tableOptionWidth}">
                <template v-slot="{ row }">
                    <div class="rowBC operate-btn-style">
                        #if($tableConfig.isEdit=="true")
                            <div style="width: 70px; text-align: left"
                                 @click="routerPushMixin('/${basicConfig.routerParentDir}/${basicConfig.apiFileName}-add-edit', {edit: true, row})">
                                <span>编辑</span></div>
                        #end
                        #if($tableConfig.isInvalid=="true")
                            <el-popconfirm
                                confirm-button-text="作废"
                                cancel-button-type=""
                                title="删除后将严重影响商户账单的生成，确定要作废该策略吗？"
                                cancel-button-text="取消"
                                @confirm="${basicConfig.apiFileNameCase}Invalid(row)"
                            >
                                <el-link slot="reference" :underline="false" class="link-color">作废</el-link>
                            </el-popconfirm>
                        #end
                        #if($tableConfig.isDetail=="true")
                            <div @click="routerPushMixin('/${basicConfig.routerParentDir}/${basicConfig.apiFileName}/detail', { row })">
                                <span>详情</span></div>
                        #end
                    </div>
                </template>
            </el-table-column>
        </el-table>
        <!--  空时的数据  -->
        <template v-else>
            <Empty :width="'300px'" :height="'223px'" class="table-empty"/>
        </template>
        #if($tableConfig.isPagination=="true")
            <!-- 分页   -->
            <div v-if="pageTotalMixin > 10" class="block columnCE">
                <el-pagination
                    :current-page="pageNumMixin"
                    :page-sizes="[10, 20, 50, 100, 200]"
                    :page-size="pageSizeMixin"
                    layout="total, sizes, prev, pager, next, jumper"
                    :total="pageTotalMixin"
                    @size-change="handleSizeMixin"
                    @current-change="handleCurrentMixin"
                />
            </div>
        #end
        #if($tableConfig.isImport=="true")
            <!--批量作废-->
            <MultiImport
                ref="refHandleImport"
                title="$tableConfig.importTitle"
                width="$tableConfig.importWidth"
                :show-down-load-tmp="$tableConfig.importShowDownLoadTmp"
                download-tmp-url="$tableConfig.importDownLoadTmpUrl"
                @multiImportSubEmit="multiImportSubEmit"
            />
        #end
    </div>
</template>

<script>
    import tableMixin from '@/mixins/tableMixin.js'
    import routerMixin from '@/mixins/routerMixin.js'
    import columnFilterMixin from '@/mixins/columnFilterMixin.js'
    import pottingMixin from './potting-mixin.js'

    export default {
        name: 'ServiceSplitFee',
        mixins: [tableMixin, routerMixin, columnFilterMixin, pottingMixin],
        props: {},
        data() {
            return {
                #queryDataScript()
                searchFormMixin: { //查询字段
                    #queryformKey()
                }
            }
        },
        created() {
            this.initData()
        },
        mounted() {
            #queryMountedScript()
            this.initQueryList()//初始请求列表数据
        },
        methods: {
            //初始化数据，可以设置默认时间等
            initData() {
                #queryInitTimeScript()
            },
            #queryMethodScript()
            //作废请求
                ${basicConfig.apiFileNameCase}Invalid({id}) {
                this.globalApi.${basicConfig.apiFileNameCase}.${basicConfig.apiFileNameCase}Invalid(id).then(() => {
                    this.queryList()
                })
            },
            //查询列表，此处重置了分页数为1
            initQueryList() {
                this.pageNumMixin = 1
                this.queryList()
            },
            //导入
            importBtnClick() {
                this.$refs.refHandleImport.showDialog = true
            },
            #if($tableConfig.isImport=="true")
                //导入请求
                multiImportSubEmit(formData) {
                    this.globalApi.${basicConfig.apiFileNameCase}.multiImport(formData).then(() => {
                        this.$message.success("导入成功")
                        this.$refs.refHandleImport.showDialog = false
                    })
                },
            #end
            #if($tableConfig.isExport=="true")
                //导出配置和请求
                exportBtnClick() {
                    let exportParams = {
                        bizCode: 'export_coupon_list_customer_coupon_export',
                        serviceUrl: '/api/v1.0/cpnCoupon/listCustomerCouponByPage',
                        serviceCountUrl: '/api/v1.0/cpnCoupon/listCustomerCouponByPage',
                        serviceId: 'http://aulton-ms-operation-coupon-service',
                        param: JSON.stringify(this.searchFormMixin),
                        //请输入您要的字段
                        tableHead: []
                    }
                    this.exportHandleMixin(exportParams)
                },
            #end
            // 分页获取table列表
            queryList() {
                const searchData = Object.assign(this.searchFormMixin, {
                    pageIndex: this.pageNumMixin,
                    pageSize: this.pageSizeMixin
                })
                //如果字段为空，则删除改字段
                Object.keys(this.searchFormMixin).forEach(key => {
                    if (!this.searchFormMixin[key] && this.searchFormMixin[key] !== 0) delete this.searchFormMixin[key]
                })
                //请求列表数据
                this.globalApi.${basicConfig.apiFileNameCase}.tableQuery(searchData).then(({data, total}) => {
                    this.tableDataMixin = data
                    this.pageTotalMixin = total
                })
            }
        }
    }
</script>

<style lang="scss" scoped></style>
